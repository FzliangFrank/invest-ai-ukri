"0","require(htmlwidgets)"
"0",""
"0","## parameter"
"0","SNOBYNESS=0.02 ## this is top n most expensive"
"0","PRICE_FORMULAR=quo("
"0","  AwardPounds/as.numeric(duration, units='days') ## this is how you calculate expensiveness"
"0",") "
"0",""
"0","## calculate award per year "
"0","price_gtr = gtr |> "
"0","  mutate(duration = EndDate - StartDate) |>"
"0","  mutate(duration_d = as.numeric(duration, units='days')) |> "
"0","  mutate(price = !! PRICE_FORMULAR) |> "
"0","  arrange(desc(price)) |> "
"0","  mutate(expensive_rank = row_number()) |>"
"0","  filter(expensive_rank <= quantile(expensive_rank, SNOBYNESS))"
"0",""
"0","g <- price_gtr |>"
"0","  ggplot(aes(y = price, label = LeadROName, label1= Title, label2 = ProjectReference)) + "
"0","  geom_linerange(aes(xmin = StartDate, xmax = EndDate, y = price, alpha = duration_d), "
"0","                 color = ""darkgrey"") +"
"0","  geom_point(aes(x = StartDate), color = ""blue"") + "
"0","  geom_point(aes(x = EndDate), color = ""navy"") +"
"0","  ggtitle(glue::glue(""Here are the top {SNOBYNESS * 100}% most expensive AI projects"")) +"
"0","  scale_alpha_continuous(trans='log')"
"0",""
"0","ggplotly(g) |>"
"0","  style(traces = 2, text = paste(price_gtr$StartDate,""\n"",price_gtr$duration, ""days"")) |>"
"0","  style(traces = 1, text = paste( price_gtr$PIFirstName, price_gtr$PISurname,""\n"",price_gtr$duration, ""days"")) |>"
"0","  style(traces = 3, customdata = price_gtr$GTRProjectUrl, text = paste(price_gtr$EndDate,""\n"", price_gtr$LeadROName, ""\n"",price_gtr$Title)) |>"
"0","  onRender("""
"0","    function(el) { "
"0","      el.on('plotly_click', function(d) { "
"0","        var url = d.points[0].customdata;"
"0","        window.open(url);"
"0","      });"
"0","    }"
"0","  "") #set up click event that open URL"
